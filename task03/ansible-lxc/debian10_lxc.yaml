---#Playbook for task03-02 (Debian10 LXC - host configuration)- name: Debian10_lxc provision  hosts: all  tasks:     - name: Ensure needed packages are installed.       become: yes       apt:         pkg:           - lxc           - lxc-templates           - python-lxc           - iptables-persistent           - python-pip             - name: Ensure lxc is running and enabled       become: yes       service:          name: lxc          state: started          enabled: yes               - name: Ensure lxc-net is running and enabled       become: yes       service:          name: lxc-net          state: started          enabled: yes     - name: Modify /etc/sysctl.conf       become: yes       lineinfile:         path: /etc/sysctl.conf         regexp: 'kernel.unprivileged_userns_clone=1'         state: present         insertafter: EOF         line: kernel.unprivileged_userns_clone=1       notify:         - restart host              - name: Modify /etc/default/grub       become: yes       replace:         path: /etc/default/grub         regexp: 'GRUB_CMDLINE_LINUX="net.ifnames=0 biosdevname=0 debian-installer=en_US.UTF-8"'         replace: 'GRUB_CMDLINE_LINUX="net.ifnames=0 systemd.legacy_systemd_cgroup_controller=yes biosdevname=0 debian-installer=en_US.UTF-8"'       notify:         - restart host     - name: Adding changes to /etc/lxc/default.conf       become: yes       copy:         dest: /etc/lxc/default.conf         content: |           lxc.net.0.type  = veth           lxc.net.0.flags = up           lxc.net.0.link  = lxcbr0     - name: Adding changes to /etc/lxc/lxc-usernet       become: yes       copy:         dest: /etc/lxc/lxc-usernet         content: |           root veth lxcbr0 10                - name: Adding changes to /etc/default/lxc-net       become: yes       copy:         dest: /etc/default/lxc-net         content: |           USE_LXC_BRIDGE="true"           LXC_BRIDGE="lxcbr0"       notify:         - restart lxc-net             - name: Forward port 80 to 10.0.3.55:80       become: yes       iptables:         table: nat         chain: PREROUTING         in_interface: eth0         protocol: tcp         destination_port: '80'         jump: DNAT         to_destination: 10.0.3.55:80      - name: Forward port 81 to 10.0.3.56:80       become: yes       iptables:         table: nat         chain: PREROUTING         in_interface: eth0         protocol: tcp         destination_port: '81'         jump: DNAT         to_destination: 10.0.3.56:80       notify:         - save iptables              - name: generate SSH key       become: yes       user:         name: "root"         generate_ssh_key: yes         ssh_key_bits: 2048         ssh_key_file: "~/.ssh/id_rsa"         force: no          - name: execute playbook to configure lxc-containers       shell: ansible-playbook -i /vagrant/inventory /vagrant/centos_lxc.yaml       register: playbook_output       changed_when: playbook_output.stdout_lines[-1] is regex("\schanged=[1-9]\d*\s")     - debug: var=playbook_output.stdout_lines       handlers:   - name: restart lxc-net     become: yes     service:       name: lxc-net       state: restarted       - name: save iptables     become: yes     shell:       cmd: iptables-save > /etc/iptables/rules.v4   - name: restart host     become: yes     shell:       cmd: shutdown -r now